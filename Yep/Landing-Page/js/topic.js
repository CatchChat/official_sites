var base64Prefix,delay,isChinese,modulate,msg_pswpItems,pswpItems,topic_pswpItems,viewImage;modulate=function(e,t,a,i,s){var r;if(r=i+(e-t)/(a-t)*(s-i),s>i){if(i>r)return i;if(r>s)return s}else{if(r>i)return i;if(s>r)return s}return r},isChinese=function(){return-1!==window.navigator.language.indexOf("zh")},delay=function(e,t){return setTimeout(t,e)},topic_pswpItems=[],msg_pswpItems=[],pswpItems=[],viewImage=function(e,t,a){var i,s,r;return i=$(".pswp")[0],s={index:t,showHideOpacity:!0,history:!1,bgOpacity:.9,getThumbBoundsFn:function(e){var t,i,s;return s=a[e],t=window.pageYOffset||document.documentElement.scrollTop,i=s.getBoundingClientRect(),{x:i.left,y:i.top+t,w:i.width}}},r=new PhotoSwipe(i,PhotoSwipeUI_Default,e,s),delay(10,function(){return r.init()})},base64Prefix="data:image/jpeg;base64,",$(function(){var e,t;return t="https://api.soyep.com/v1/circles/shared_messages",e="?token="+$.url("?token")+"&callback=?",$.getJSON(t+e,function(e){var t,a,i,s,r,n,o,d,l,u,p,c,m,h,g,b,f,w,v,_,k,y,C,x,I,O,P;switch(r=e.circle,C=e.topic,h=e.messages,u=C.kind,$(".topic .avatar").css("background-image","url("+C.user.avatar.thumb_url+")"),$(".topic .avatar").attr("username",C.user.username),$(".topic .nickname").html(C.user.nickname),$(".topic .time").html($.timeago(1e3*r.created_at)),C.body?$(".topic .text").html(C.body):$(".topic .text").hide(),"image"!==u&&$(".topic .images").remove(),u){case"image":for(_=C.attachments,d=0,p=_.length;p>d;d++)x=_[d],I=$.parseJSON(x.metadata),P=base64Prefix+I.thumbnail_string,$("<div/>",{"class":"thumbnail"}).css("background-image","url("+P+")").appendTo(".images .thumbnails"),O={msrc:P,src:x.file.url,w:I.image_width,h:I.image_height},topic_pswpItems.push(O);$(".topic .images .thumbnails .thumbnail").on("tap",function(){return viewImage(topic_pswpItems,$(this).index(),$(".topic .images .thumbnails .thumbnail"))});break;case"audio":t=C.attachments[0],s=$.parseJSON(t.metadata),a=Math.round(s.audio_duration),i=$("<audio controls>",{src:t.file.url,preload:"auto"}),i.append($("<source>",{src:t.file.url,type:"audio/mpeg"})),n=$(".topic .audio"),n.addClass("audio").append(i),n.addClass("audio").append($("<button/>")),n.addClass("audio").append($("<progress/>",{max:100,value:0}).css("width",20*a+"px")),n.addClass("audio").append($("<label/>").html(a+"″")),n.appendTo(".topic .audio");break;case"dribbble":y=C.attachments[0],$(".topic .dribbble").show(),$(".topic .dribbble img.shot").attr("src",y.media_url),$(".topic .dribbble a.link").html(y.title).attr("href",y.url).attr("target","_blank"),pswpItems=[{msrc:y.media_url,src:y.media_url.replace("_1x.","."),w:800,h:600}],$(".topic .dribbble .shot").on("tap",function(){return viewImage(pswpItems,0,$(this))});break;case"github":k=C.attachments[0],$(".topic .github").css("display","table").attr("href",k.url).attr("target","_blank"),$(".topic .github .name").html(k.name),$(".topic .github .desc").html(k.description)}for($(".chat").css("padding-top",$(".topic").css("height")),h.length?$(".nomsg").hide():$(".footer .popup").addClass("show"),l=0,c=h.length;c>l;l++){if(g=h[l],g.deleted)o=$("<div/>",{"class":"cell"}),n=$("<div/>",{"class":"narrator"}).html(g.sender.nickname+" recalled a message"),n.appendTo(o);else switch(o=$(".template.cell").clone().removeClass("template"),n=o.find(".content"),o.find(".avatar").css("background-image","url("+g.sender.avatar.thumb_url+")"),g.sender.username&&o.find(".avatar").css("cursor","pointer"),o.find(".avatar").attr("username",g.sender.username),o.find(".nickname").html(g.sender.nickname),b=g.attachments[0],v=b?$.parseJSON(b.metadata):void 0,g.media_type){case"text":n.addClass("text").html(g.text_content);break;case"image":f=$.parseJSON(b.metadata),w=base64Prefix+f.blurred_thumbnail_string,n.addClass("image").append($("<img/>",{src:b.file.thumb_url})).css("background-image","url("+w+")"),msg_pswpItems.push({msrc:b.file.thumb_url,src:b.file.url,w:f.image_width,h:f.image_height});break;case"audio":a=Math.round(v.audio_duration),i=$("<audio controls>",{src:b.file.url,preload:"auto"}),i.append($("<source>",{src:b.file.url,type:"audio/mpeg"})),n.addClass("audio").append(i),n.addClass("audio").append($("<button/>")),n.addClass("audio").append($("<progress/>",{max:100,value:0}).css("width",20*a+"px")),n.addClass("audio").append($("<label/>").html(a+"″"));break;case"location":m={key:"P8qeoPmMSc6FKpMvbLKWVrR0",lng:g.longitude,lat:g.latitude,address:g.text_content,width:200,height:100,zoom:16},m.img="https://api.map.baidu.com/staticimage?center="+m.lng+","+m.lat+"&width="+m.width+"&height="+m.height+"&zoom="+m.zoom+"&ak="+m.key,m.url="https://maps.google.cn/maps?q="+m.lat+","+m.lng+"&z="+m.zoom+"&ll="+m.lat+","+m.lng,n.attr("href",m.url),n.attr("target","_blank"),n.addClass("location").css({width:m.width+"px",height:m.height+"px",backgroundImage:"url("+m.img+")"}),n.append($("<div/>",{"class":"marker"})),m.address&&n.append($("<div/>",{"class":"address"}).html(m.address))}o.appendTo(".chat .table")}return $(".chat .bubble .image").click(function(){return viewImage(msg_pswpItems,$(".chat .bubble .image").index($(this)),$(".chat .bubble .image"))}),$(".avatar").click(function(){var e;return e=$(this).attr("username"),e?window.open("https://soyep.com/"+e):void 0}),$(document).scroll(function(){return $(this).scrollTop()>=$(this).height()-$(window).height()-100?$(".footer .popup").addClass("show"):$(".footer .popup").removeClass("show")}),$(".chat .bubble .audio, .topic .audio").on("tap",function(){var e,t,a;return a=$.media($(this).find("audio")),t=$(this).find("button"),e=$(this).find("progress"),a.playPause(),a.play(function(){return t.addClass("playing")}),a.pause(function(){return t.removeClass("playing")}),a.ended(function(){return t.removeClass("playing"),a.stop(),e.attr("value",0)}),a.time(function(){var t;return t=modulate(this.time(),0,this.duration(),0,100),e.attr("value",t)})}),$(".text").linkify()}),os.ios&&$(".android").hide(),os.android&&$(".ios").hide(),"-webkit-backdrop-filter"in document.body.style?($(".footer").addClass("bfblur"),$(".container .topic").addClass("bfblur"),$(".pswp__bg").addClass("bfblur dark")):void 0});
//# sourceMappingURL=topic.js.map
