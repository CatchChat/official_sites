var base64Prefix,delay,isChinese,modulate,msg_pswpItems,pswpItems,topic_pswpItems,viewImage;modulate=function(t,e,a,i,s){var r;if(r=i+(t-e)/(a-e)*(s-i),s>i){if(i>r)return i;if(r>s)return s}else{if(r>i)return i;if(s>r)return s}return r},isChinese=function(){return-1!==window.navigator.language.indexOf("zh")},delay=function(t,e){return setTimeout(e,t)},topic_pswpItems=[],msg_pswpItems=[],pswpItems=[],viewImage=function(t,e,a){var i,s,r;return i=$(".pswp")[0],s={index:e,showHideOpacity:!0,history:!1,bgOpacity:.9,getThumbBoundsFn:function(t){var e,i,s;return s=a[t],e=window.pageYOffset||document.documentElement.scrollTop,i=s.getBoundingClientRect(),{x:i.left,y:i.top+e,w:i.width}}},r=new PhotoSwipe(i,PhotoSwipeUI_Default,t,s),delay(10,function(){return r.init()})},base64Prefix="data:image/jpeg;base64,",$(function(){var t,e;return e="https://park.catchchatchina.com/api/v2/circles/shared_messages",t="?token="+$.url("?token")+"&callback=?",$.getJSON(e+t,function(t){var e,a,i,s,r,n,o,d,l,u,c,p,m,h,g,b,f,w,v,_,k,x,y,C,I;switch(i=t.circle,k=t.topic,p=t.messages,d=k.kind,$(".topic .avatar").css("background-image","url("+k.user.avatar_url+")"),$(".topic .avatar").attr("username",k.user.username),$(".topic .nickname").html(k.user.nickname),$(".topic .time").html($.timeago(1e3*i.created_at)),k.body?$(".topic .text").html(k.body):$(".topic .text").hide(),"image"!==d&&$(".topic .images").remove(),d){case"image":for(w=k.attachments,n=0,l=w.length;l>n;n++)x=w[n],y=$.parseJSON(x.metadata),I=base64Prefix+y.thumbnail_string,$("<div/>").addClass("thumbnail").css("background-image","url("+I+")").appendTo(".images .thumbnails"),C={msrc:I,src:x.file.url,w:y.image_width,h:y.image_height},topic_pswpItems.push(C);$(".topic .images .thumbnails .thumbnail").on("tap",function(){return viewImage(topic_pswpItems,$(this).index(),$(".topic .images .thumbnails .thumbnail"))});break;case"dribbble":_=k.attachments[0],$(".topic .dribbble").show(),$(".topic .dribbble img.shot").attr("src",_.media_url),$(".topic .dribbble a.link").html(_.title).attr("href",_.url).attr("target","_blank"),pswpItems=[{msrc:_.media_url,src:_.media_url.replace("_1x.","."),w:800,h:600}],$(".topic .dribbble .shot").on("tap",function(){return viewImage(pswpItems,0,$(this))});break;case"github":v=k.attachments[0],$(".topic .github").css("display","table").attr("href",v.url).attr("target","_blank"),$(".topic .github .name").html(v.name),$(".topic .github .desc").html(v.description)}for($(".chat").css("padding-top",$(".topic").css("height")),o=0,u=p.length;u>o;o++){switch(m=p[o],r=$(".template.cell").clone().removeClass("template"),s=r.find(".content"),r.find(".avatar").css("background-image","url("+m.sender.avatar_url+")"),r.find(".avatar").attr("username",m.sender.username),r.find(".nickname").html(m.sender.nickname),h=m.attachments[0],f=h?$.parseJSON(h.metadata):void 0,m.media_type){case"text":s.addClass("text").html(m.text_content);break;case"image":g=$.parseJSON(h.metadata),b=base64Prefix+g.blurred_thumbnail_string,s.addClass("image").append($("<img/>",{src:h.file.url})).css("background-image","url("+b+")"),msg_pswpItems.push({msrc:b,src:h.file.url,w:g.image_width,h:g.image_height});break;case"audio":e=Math.round(f.audio_duration),a=$("<audio controls>",{src:h.file.url,preload:"auto"}),a.append($("<source>",{src:h.file.url,type:"audio/mpeg"})),s.addClass("audio").append(a),s.addClass("audio").append($("<button/>")),s.addClass("audio").append($("<progress/>",{max:100,value:0}).css("width",20*e+"px")),s.addClass("audio").append($("<label/>").html(e+"â€³"));break;case"location":c={key:"P8qeoPmMSc6FKpMvbLKWVrR0",lng:m.longitude,lat:m.latitude,address:m.text_content,width:200,height:100,zoom:16},c.img="https://api.map.baidu.com/staticimage?center="+c.lng+","+c.lat+"&width="+c.width+"&height="+c.height+"&zoom="+c.zoom+"&ak="+c.key,c.url="https://maps.google.cn/maps?q="+c.lat+","+c.lng+"&z="+c.zoom+"&ll="+c.lat+","+c.lng,s.attr("href",c.url),s.attr("target","_blank"),s.addClass("location").css({width:c.width+"px",height:c.height+"px",backgroundImage:"url("+c.img+")"}),s.append($("<div/>").addClass("marker")),c.address&&s.append($("<div/>").addClass("address").html(c.address))}r.appendTo(".chat .table")}return $(".chat .bubble .image").on("tap",function(){return viewImage(msg_pswpItems,$(".chat .bubble .image").index($(this)),$(".chat .bubble .image"))}),$(".avatar").click(function(){var t;return t=$(this).attr("username"),t?window.open("https://soyep.com/"+t):void 0}),$(document).scroll(function(){return $(this).scrollTop()>=$(this).height()-$(window).height()-100?$(".footer .popup").addClass("show"):$(".footer .popup").removeClass("show")}),$(".chat .bubble .audio").on("tap",function(){var t,e,a;return a=$.media($(this).find("audio")),e=$(this).find("button"),t=$(this).find("progress"),a.playPause(),a.play(function(){return e.addClass("playing")}),a.pause(function(){return e.removeClass("playing")}),a.ended(function(){return e.removeClass("playing"),a.stop()}),a.time(function(){var e;return e=modulate(this.time(),0,this.duration(),0,100),t.attr("value",e)})})}),os.ios&&$(".android").hide(),os.android?$(".ios").hide():void 0});
//# sourceMappingURL=topic.js.map
