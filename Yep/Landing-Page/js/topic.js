var base64Prefix,delay,isChinese,modulate,msg_pswpItems,pswpItems,topic_pswpItems,viewImage;modulate=function(e,t,a,i,s){var r;if(r=i+(e-t)/(a-t)*(s-i),s>i){if(i>r)return i;if(r>s)return s}else{if(r>i)return i;if(s>r)return s}return r},isChinese=function(){return-1!==window.navigator.language.indexOf("zh")},delay=function(e,t){return setTimeout(t,e)},topic_pswpItems=[],msg_pswpItems=[],pswpItems=[],viewImage=function(e,t,a){var i,s,r;return i=$(".pswp")[0],s={index:t,showHideOpacity:!0,history:!1,bgOpacity:.9,getThumbBoundsFn:function(e){var t,i,s;return s=a[e],t=window.pageYOffset||document.documentElement.scrollTop,i=s.getBoundingClientRect(),{x:i.left,y:i.top+t,w:i.width}}},r=new PhotoSwipe(i,PhotoSwipeUI_Default,e,s),delay(10,function(){return r.init()})},base64Prefix="data:image/jpeg;base64,",$(function(){var e,t;return t="https://api.soyep.com/v1/circles/shared_messages",e="?token="+$.url("?token")+"&callback=?",$.getJSON(t+e,function(e){var t,a,i,s,r,n,o,d,l,u,c,m,p,h,g,b,f,w,v,_,k,y,x,I,C;switch(i=e.circle,k=e.topic,m=e.messages,d=k.kind,$(".topic .avatar").css("background-image","url("+k.user.avatar.thumb_url+")"),$(".topic .avatar").attr("username",k.user.username),$(".topic .nickname").html(k.user.nickname),$(".topic .time").html($.timeago(1e3*i.created_at)),k.body?$(".topic .text").html(k.body):$(".topic .text").hide(),"image"!==d&&$(".topic .images").remove(),d){case"image":for(w=k.attachments,n=0,l=w.length;l>n;n++)y=w[n],x=$.parseJSON(y.metadata),C=base64Prefix+x.thumbnail_string,$("<div/>",{"class":"thumbnail"}).css("background-image","url("+C+")").appendTo(".images .thumbnails"),I={msrc:C,src:y.file.url,w:x.image_width,h:x.image_height},topic_pswpItems.push(I);$(".topic .images .thumbnails .thumbnail").on("tap",function(){return viewImage(topic_pswpItems,$(this).index(),$(".topic .images .thumbnails .thumbnail"))});break;case"dribbble":_=k.attachments[0],$(".topic .dribbble").show(),$(".topic .dribbble img.shot").attr("src",_.media_url),$(".topic .dribbble a.link").html(_.title).attr("href",_.url).attr("target","_blank"),pswpItems=[{msrc:_.media_url,src:_.media_url.replace("_1x.","."),w:800,h:600}],$(".topic .dribbble .shot").on("tap",function(){return viewImage(pswpItems,0,$(this))});break;case"github":v=k.attachments[0],$(".topic .github").css("display","table").attr("href",v.url).attr("target","_blank"),$(".topic .github .name").html(v.name),$(".topic .github .desc").html(v.description)}for($(".chat").css("padding-top",$(".topic").css("height")),o=0,u=m.length;u>o;o++){if(p=m[o],p.deleted)console.log("deleted!"),r=$("<div/>",{"class":"cell"}),s=$("<div/>",{"class":"narrator"}).html(p.sender.nickname+" recalled a message"),s.appendTo(r);else switch(r=$(".template.cell").clone().removeClass("template"),s=r.find(".content"),r.find(".avatar").css("background-image","url("+p.sender.avatar.thumb_url+")"),p.sender.username&&r.find(".avatar").css("cursor","pointer"),r.find(".avatar").attr("username",p.sender.username),r.find(".nickname").html(p.sender.nickname),h=p.attachments[0],f=h?$.parseJSON(h.metadata):void 0,p.media_type){case"text":s.addClass("text").html(p.text_content);break;case"image":g=$.parseJSON(h.metadata),b=base64Prefix+g.blurred_thumbnail_string,s.addClass("image").append($("<img/>",{src:h.file.thumb_url})).css("background-image","url("+b+")"),msg_pswpItems.push({msrc:h.file.thumb_url,src:h.file.url,w:g.image_width,h:g.image_height});break;case"audio":t=Math.round(f.audio_duration),a=$("<audio controls>",{src:h.file.url,preload:"auto"}),a.append($("<source>",{src:h.file.url,type:"audio/mpeg"})),s.addClass("audio").append(a),s.addClass("audio").append($("<button/>")),s.addClass("audio").append($("<progress/>",{max:100,value:0}).css("width",20*t+"px")),s.addClass("audio").append($("<label/>").html(t+"â€³"));break;case"location":c={key:"P8qeoPmMSc6FKpMvbLKWVrR0",lng:p.longitude,lat:p.latitude,address:p.text_content,width:200,height:100,zoom:16},c.img="https://api.map.baidu.com/staticimage?center="+c.lng+","+c.lat+"&width="+c.width+"&height="+c.height+"&zoom="+c.zoom+"&ak="+c.key,c.url="https://maps.google.cn/maps?q="+c.lat+","+c.lng+"&z="+c.zoom+"&ll="+c.lat+","+c.lng,s.attr("href",c.url),s.attr("target","_blank"),s.addClass("location").css({width:c.width+"px",height:c.height+"px",backgroundImage:"url("+c.img+")"}),s.append($("<div/>",{"class":"marker"})),c.address&&s.append($("<div/>",{"class":"address"}).html(c.address))}r.appendTo(".chat .table")}return $(".chat .bubble .image").on("tap",function(){return viewImage(msg_pswpItems,$(".chat .bubble .image").index($(this)),$(".chat .bubble .image"))}),$(".avatar").click(function(){var e;return e=$(this).attr("username"),e?window.open("https://soyep.com/"+e):void 0}),$(document).scroll(function(){return $(this).scrollTop()>=$(this).height()-$(window).height()-100?$(".footer .popup").addClass("show"):$(".footer .popup").removeClass("show")}),$(".chat .bubble .audio").on("tap",function(){var e,t,a;return a=$.media($(this).find("audio")),t=$(this).find("button"),e=$(this).find("progress"),a.playPause(),a.play(function(){return t.addClass("playing")}),a.pause(function(){return t.removeClass("playing")}),a.ended(function(){return t.removeClass("playing"),a.stop()}),a.time(function(){var t;return t=modulate(this.time(),0,this.duration(),0,100),e.attr("value",t)})})}),os.ios&&$(".android").hide(),os.android?$(".ios").hide():void 0});
//# sourceMappingURL=topic.js.map
